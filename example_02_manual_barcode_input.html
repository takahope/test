<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>範例 02：手動輸入條碼</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">

    <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">手動輸入條碼驗證器</h1>

        <!-- 手動輸入區 -->
        <div class="mb-4">
            <label for="barcode-input" class="block text-sm font-medium text-gray-700 mb-2">
                條碼輸入（手動輸入或掃碼槍）
            </label>
            <div class="flex gap-2">
                <input
                    type="text"
                    id="barcode-input"
                    placeholder="請輸入條碼後按 Enter 或點擊添加..."
                    class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                    autofocus
                >
                <button
                    id="add-btn"
                    class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">
                    添加
                </button>
            </div>
            <p id="error-msg" class="text-red-500 text-sm mt-1 hidden">找不到此條碼對應的項目</p>
            <p class="text-gray-500 text-xs mt-1">提示：支援掃碼槍直接輸入</p>
        </div>

        <!-- 測試數據提示 -->
        <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <h3 class="text-sm font-semibold text-blue-800 mb-2">測試條碼範例</h3>
            <div class="space-y-1 text-xs text-blue-700">
                <div>• 123456789012 - 商品 A</div>
                <div>• 987654321098 - 商品 B</div>
                <div>• 555666777888 - 商品 C</div>
            </div>
        </div>

        <!-- 掃描歷史記錄 -->
        <div class="mb-4">
            <h2 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-3">
                掃描記錄 <span id="count" class="text-sm font-normal text-gray-500">(0)</span>
                <button id="clear-btn" class="float-right text-xs px-2 py-1 text-red-600 hover:bg-red-50 rounded hidden">
                    清除全部
                </button>
            </h2>
            <div id="history" class="min-h-[100px] max-h-[400px] overflow-y-auto bg-gray-50 p-3 rounded-md border border-gray-200">
                <p id="placeholder" class="text-gray-400 text-sm">尚未掃描任何條碼...</p>
            </div>
        </div>
    </div>

    <script>
        // 模擬的商品數據庫
        const products = [
            { barcode: '123456789012', name: '商品 A', price: 100 },
            { barcode: '987654321098', name: '商品 B', price: 200 },
            { barcode: '555666777888', name: '商品 C', price: 150 },
        ];

        // 掃描歷史
        const scannedItems = [];

        // DOM 元素
        const barcodeInput = document.getElementById('barcode-input');
        const addBtn = document.getElementById('add-btn');
        const errorMsg = document.getElementById('error-msg');
        const historyDiv = document.getElementById('history');
        const placeholder = document.getElementById('placeholder');
        const countSpan = document.getElementById('count');
        const clearBtn = document.getElementById('clear-btn');

        // Enter 鍵處理
        barcodeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                processBarcode();
            }
        });

        // 添加按鈕處理
        addBtn.addEventListener('click', processBarcode);

        // 清除按鈕處理
        clearBtn.addEventListener('click', clearAll);

        function processBarcode() {
            const barcode = barcodeInput.value.trim();

            if (!barcode) {
                showError('請輸入條碼');
                return;
            }

            // 查找商品
            const product = products.find(p => p.barcode === barcode);

            if (product) {
                // 找到商品，添加到歷史
                addToHistory(product);
                barcodeInput.value = '';
                hideError();
                barcodeInput.focus();
            } else {
                // 未找到商品
                showError('找不到此條碼對應的項目');
            }
        }

        function addToHistory(product) {
            const timestamp = new Date().toLocaleTimeString('zh-TW');

            scannedItems.push({
                ...product,
                timestamp
            });

            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const count = scannedItems.length;
            countSpan.textContent = `(${count})`;

            if (count > 0) {
                placeholder.classList.add('hidden');
                clearBtn.classList.remove('hidden');

                historyDiv.innerHTML = scannedItems.map((item, index) => `
                    <div class="bg-white p-3 rounded mb-2 border border-gray-200 flex items-center justify-between">
                        <div class="flex-1">
                            <div class="font-medium text-gray-700">${item.name}</div>
                            <div class="text-xs text-gray-500">條碼：${item.barcode}</div>
                            <div class="text-xs text-gray-500">價格：NT$ ${item.price}</div>
                            <div class="text-xs text-blue-600">${item.timestamp}</div>
                        </div>
                        <button
                            onclick="removeItem(${index})"
                            class="ml-2 text-red-500 hover:text-red-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                `).join('');
            } else {
                placeholder.classList.remove('hidden');
                clearBtn.classList.add('hidden');
                historyDiv.innerHTML = '<p id="placeholder" class="text-gray-400 text-sm">尚未掃描任何條碼...</p>';
            }
        }

        function removeItem(index) {
            scannedItems.splice(index, 1);
            updateHistoryDisplay();
        }

        function clearAll() {
            if (confirm('確定要清除所有記錄嗎？')) {
                scannedItems.length = 0;
                updateHistoryDisplay();
            }
        }

        function showError(message) {
            errorMsg.textContent = message;
            errorMsg.classList.remove('hidden');
            barcodeInput.classList.add('border-red-500');
        }

        function hideError() {
            errorMsg.classList.add('hidden');
            barcodeInput.classList.remove('border-red-500');
        }
    </script>

</body>
</html>
